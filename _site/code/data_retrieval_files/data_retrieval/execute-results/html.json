{
  "hash": "a41d41e121d9adf824d91d8efb798a08",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data Retrieval\"\nsubtitle: \"\"\ndate: February 09, 2024\ndate-modified:  last-modified\nformat:\n  html:\n    toc: true\n    number-sections: false\n    code-line-numbers: false\n    \nexecute: \n  eval: true\n  echo: true\n  warning: false  \n\ndraft: true\n---\n\n\n::: callout-note\npage in draft mode\n:::\n\n# Climate Historical Daily Records\n\nThe Climate Historical Daily Records of various climate stations in Singapore can be retrieved from [here](http://www.weather.gov.sg/climate-historical-daily/). However, as the data is available in .csv files for each month, we have written the below code to:\n\n1.   retrieve all the available climate historical daily records\n2.  compile the data into a single .csv file\n\n::: callout-note\nThe availability of observational data and duration of records vary across stations. Manual observations were gradually replaced by automated meteorological instruments from 2009.\n\n[This file](http://www.weather.gov.sg/wp-content/uploads/2022/06/Station_Records.pdf) contains the list of stations, weather parameters and periods of records available. The file has been saved as an .XLSX file, and the respective station codes have been added to the .XLSX file.\n:::\n\n## Getting Started\n\n### Load required libraries\n\n-   `httr` will be used for making HTTP requests, downloading, and saving files\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(httr, readxl, dplyr, readr)\n```\n:::\n\n\n## Download data: Climate **Historical Daily Records**\n\nFirst, retrieve the list of station codes from the file Station_Records.xlsx.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstation_records <- read_excel(\"../../data/Station_Records.xlsx\")\n\n# Obtain a list of station codes\nstation_codes <- station_records$`Station Code`\n```\n:::\n\n\nNext, loop through all 63 station codes from the time period of Jan 2014 to Dec 2023 and download all files available for each station.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set base URL template and save directory\nbase_url_template <- \"http://www.weather.gov.sg/files/dailydata/DAILYDATA_%s_%d%s.csv\"\nsave_directory <- \"../../data/raw_climate_historical_daily_records\"\ndir.create(save_directory, recursive = TRUE, showWarnings = FALSE)\n\n# Loop through each station code\nfor (station_code in station_codes) {\n  # Loop through each year and month\n  for (year in 2014:2023) {\n    for (month in 1:12) {\n      # Format the month properly as a string\n      month_str <- sprintf(\"%02d\", month)\n      \n      # Construct the full URL\n      file_url <- sprintf(base_url_template, station_code, year, month_str)\n      \n      # Make the request and save the file\n      response <- GET(file_url)\n      \n      # Check if the request was successful (status code 200)\n      if (status_code(response) == 200) {\n        file_path <- sprintf(\"%s/DAILYDATA_%s_%d%s.csv\", save_directory, station_code, year, month_str)\n        writeBin(content(response, \"raw\"), file_path)\n        print(paste(\"Downloaded:\", file_path))\n      } else {\n        print(paste(\"Failed to download:\", file_url))\n      }\n    }\n  }\n}\n\nprint(\"Download process completed for all stations.\")\n```\n:::\n\n\nThe next few steps were completed in python due to better efficiency in handling large amount of .CSV files with varying encoding.\n\n-   Combine all downloaded CSV files into one dataframe.\n-   Performing cleaning to merge data of columns with slightly different names due to case sensitivity (e.g., \"min\" vs. \"Min\")\n  -   ('Highest 30 **Min** Rainfall (mm)', 'Highest 30 **min** Rainfall (mm)')\n  -   ('Highest 60 **Min** Rainfall (mm)', 'Highest 60 **min** Rainfall (mm)')\n  -   ('Highest 120 **Min** Rainfall (mm)', 'Highest 120 **min** Rainfall (mm)')\n-   Add the latitude and longitude of each station to the dataframe.\n\n\nTo load this CSV file for climate historical daily records in the future, follow the code in the code chunk below. \n\n::: {.cell}\n\n```{.r .cell-code}\nweather_data <- read_csv(\"../../data/climate_historical_daily_records.csv\") \n```\n:::\n\n\n# Air Quality\n\n*Done in python: Combined the 5 air quality .CSV files into a single CSV file, and adding area as a column in the CSV file.\n\n\nTo load the data for air quality in the future, follow the code in the code chunk below. \n\n::: {.cell}\n\n```{.r .cell-code}\npollutants_data <- read_csv(\"../../data/pollutants_singapore.csv\") \n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}